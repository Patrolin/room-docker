<head>
	<style>
		body {
			margin: 0;
		}
		body > * {
			width: 100%;
		}
		output {
			white-space: pre;
		}
	</style>
</head>

<body id="body">
	<input
		row
		autofocus
		id="inp"
		type="text"
		placeholder="Send a message!"
	/>
	<output row whitespace id="out"></output>
	<script>
		const socket = new WebSocket(
			`ws://${location.host}/chat`
		);

		const open = new Promise(function (
			resolve,
			reject
		) {
			socket.addEventListener('open', function (e) {
				console.log('Connection open!');
				resolve();
			});
		});

		inp.addEventListener('keydown', async function (e) {
			if (e.key === 'Enter') {
				await open;
				socket.send(inp.value);
				out.value += `${inp.value}\n`;
				inp.value = '';
			}
		});

		socket.addEventListener('close', function (e) {
			console.log('Connection closed!');
		});

		socket.addEventListener('message', function (e) {
			console.log(e.data);
			out.value += e.data;
		});
	</script>
</body>
